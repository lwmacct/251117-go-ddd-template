# 审计日志导出功能

> **状态**: ✅ 代码实现完成（待测试）
> **优先级**: 中
> **完成日期**: 2024-11-30

<!--TOC-->

## Table of Contents

- [需求背景](#需求背景) `:25+4`
- [技术方案](#技术方案) `:29+25`
  - [前端实现方案](#前端实现方案) `:31+8`
  - [导出格式](#导出格式) `:39+15`
- [开发计划](#开发计划) `:54+19`
  - [步骤 1: 创建导出工具函数](#步骤-1-创建导出工具函数) `:56+5`
  - [步骤 2: 添加导出按钮和逻辑](#步骤-2-添加导出按钮和逻辑) `:61+5`
  - [步骤 3: 测试验证](#步骤-3-测试验证) `:66+7`
- [进度记录](#进度记录) `:73+8`
- [相关文件](#相关文件) `:81+12`
- [注意事项](#注意事项) `:93+5`

<!--TOC-->

## 需求背景

管理员需要将审计日志导出为 CSV 文件，用于合规审计、数据分析或备份存档。当前页面已支持过滤和查看，缺少导出功能。

## 技术方案

### 前端实现方案

由于后端未提供专门的导出 API，采用**前端导出**方案：

1. 使用现有的分页 API 获取数据
2. 前端将数据转换为 CSV 格式
3. 使用 Blob 下载文件

### 导出格式

CSV 文件包含以下列：

- ID
- 用户ID
- 操作类型
- 资源类型
- 资源ID
- 状态
- IP地址
- User Agent
- 详情
- 创建时间

## 开发计划

### 步骤 1: 创建导出工具函数

- [x] 创建 `web/src/utils/export.ts` 工具文件
- [x] 实现 `exportToCSV` 函数（支持中文 BOM）

### 步骤 2: 添加导出按钮和逻辑

- [x] 在 `useAuditLogs.ts` 添加 `exportLogs` 方法
- [x] 在页面添加导出按钮（带 loading 状态）

### 步骤 3: 测试验证

- [ ] 测试 CSV 导出功能
- [ ] 验证中文编码正确

> **注意**: 测试验证需要在运行环境中进行手动测试。

## 进度记录

| 日期       | 步骤                 | 状态          | 备注                 |
| ---------- | -------------------- | ------------- | -------------------- |
| 2024-11-30 | 步骤 1: 创建导出工具 | ✅ 完成       | exportToCSV 通用函数 |
| 2024-11-30 | 步骤 2: 添加导出功能 | ✅ 完成       | 集成到审计日志页面   |
| -          | 步骤 3: 测试验证     | ⏳ 待手动测试 | 需在运行环境中验证   |

## 相关文件

```
web/src/
├── utils/
│   └── export.ts                     # 导出工具函数（新建）
├── pages/admin/auditlogs/
│   ├── index.vue                     # 添加导出按钮
│   └── composables/
│       └── useAuditLogs.ts           # 添加导出方法
```

## 注意事项

1. **数据量限制**: 单次导出限制最多 1000 条记录，避免性能问题
2. **中文编码**: CSV 文件使用 UTF-8 with BOM 确保 Excel 正确显示中文
3. **过滤条件**: 导出时应用当前过滤条件

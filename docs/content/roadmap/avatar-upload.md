# 用户头像上传功能

> **状态**: ✅ 代码实现完成（待测试）
> **优先级**: 中
> **完成日期**: 2024-11-30

<!--TOC-->

## Table of Contents

- [需求背景](#需求背景) `:25+8`
- [技术方案](#技术方案) `:33+18`
  - [后端 API](#后端-api) `:35+9`
  - [前端实现](#前端实现) `:44+7`
- [开发计划](#开发计划) `:51+23`
  - [步骤 1: 创建头像上传组件](#步骤-1-创建头像上传组件) `:53+7`
  - [步骤 2: 集成到个人资料页面](#步骤-2-集成到个人资料页面) `:60+6`
  - [步骤 3: 测试验证](#步骤-3-测试验证) `:66+8`
- [进度记录](#进度记录) `:74+8`
- [相关文件](#相关文件) `:82+12`
- [注意事项](#注意事项) `:94+6`

<!--TOC-->

## 需求背景

当前个人资料页面的头像只支持手动输入 URL，用户体验不佳。需要添加图片上传功能，支持：

- 本地图片选择和预览
- 图片转换为 Base64 Data URL
- 头像显示优化

## 技术方案

### 后端 API

后端已支持 avatar 字段（URL 字符串格式）：

```
PUT /api/user/profile
Request Body: { "avatar": "data:image/png;base64,..." }
```

### 前端实现

1. 创建 `AvatarUploader` 组件
2. 使用 File API 读取图片
3. 转换为 Base64 Data URL
4. 集成到个人资料编辑表单

## 开发计划

### 步骤 1: 创建头像上传组件

- [x] 创建 `web/src/components/AvatarUploader.vue`
- [x] 实现文件选择和预览
- [x] 支持拖拽上传
- [x] 添加图片大小限制（默认 2MB）

### 步骤 2: 集成到个人资料页面

- [x] 修改 `BasicInfoForm.vue` 使用新组件
- [x] 在页面显示头像预览（带默认图标）
- [x] 优化表单布局（头像居中显示）

### 步骤 3: 测试验证

- [ ] 测试图片上传和预览
- [ ] 测试大小限制
- [ ] 验证 Base64 编码正确

> **注意**: 测试验证需要在运行环境中进行手动测试。

## 进度记录

| 日期       | 步骤                       | 状态          | 备注                   |
| ---------- | -------------------------- | ------------- | ---------------------- |
| 2024-11-30 | 步骤 1: 创建头像上传组件   | ✅ 完成       | 支持拖拽、预览、Base64 |
| 2024-11-30 | 步骤 2: 集成到个人资料页面 | ✅ 完成       | 优化显示布局           |
| -          | 步骤 3: 测试验证           | ⏳ 待手动测试 | 需在运行环境中验证     |

## 相关文件

```
web/src/
├── components/
│   └── AvatarUploader.vue           # 头像上传组件（新建）
├── pages/user/profile/
│   ├── index.vue                    # 添加头像显示
│   └── components/
│       └── BasicInfoForm.vue        # 集成上传组件
```

## 注意事项

1. **文件大小**: 限制图片大小不超过 2MB
2. **图片格式**: 支持 JPG、PNG、GIF
3. **Base64 大小**: Data URL 会比原图大约 33%，需注意
4. **预览体验**: 上传后立即显示预览

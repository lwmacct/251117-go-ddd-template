# 账户删除功能

> **状态**: ✅ 代码实现完成（待测试）
> **优先级**: 高
> **完成日期**: 2024-11-30

<!--TOC-->

## Table of Contents

- [需求背景](#需求背景) `:26+4`
- [技术方案](#技术方案) `:30+14`
  - [后端 API](#后端-api) `:32+8`
  - [前端实现](#前端实现) `:40+4`
- [开发计划](#开发计划) `:44+26`
  - [步骤 1: API 调用函数](#步骤-1-api-调用函数) `:46+5`
  - [步骤 2: 删除账户组件](#步骤-2-删除账户组件) `:51+6`
  - [步骤 3: 页面集成](#步骤-3-页面集成) `:57+5`
  - [步骤 4: 测试验证](#步骤-4-测试验证) `:62+8`
- [进度记录](#进度记录) `:70+9`
- [相关文件](#相关文件) `:79+11`
- [注意事项](#注意事项) `:90+6`

<!--TOC-->

## 需求背景

根据 GDPR 等隐私法规要求，用户应有权删除自己的账户和相关数据。后端已实现 `DELETE /api/user/account` 接口，前端需要添加相应的 UI 界面。

## 技术方案

### 后端 API

```
DELETE /api/user/account
Request Body: { "password": "string" }
Response: 204 No Content
```

### 前端实现

在「安全设置」页面添加「删除账户」功能区块。

## 开发计划

### 步骤 1: API 调用函数

- [x] 在 `web/src/api/auth/user.ts` 添加 `deleteAccount` 函数
- [x] 添加相关类型定义 `DeleteAccountRequest`

### 步骤 2: 删除账户组件

- [x] 创建 `web/src/pages/user/security/components/DeleteAccountSettings.vue`
- [x] 实现密码确认表单
- [x] 添加警告提示和确认对话框（二次确认输入 "DELETE"）

### 步骤 3: 页面集成

- [x] 在 `web/src/pages/user/security/index.vue` 添加「删除账户」Tab
- [x] 集成 DeleteAccountSettings 组件

### 步骤 4: 测试验证

- [ ] 测试正常删除流程
- [ ] 测试密码错误情况
- [ ] 测试删除后跳转

> **注意**: 测试验证需要在运行环境中进行手动测试。

## 进度记录

| 日期       | 步骤                 | 状态          | 备注                    |
| ---------- | -------------------- | ------------- | ----------------------- |
| 2024-11-30 | 步骤 1: API 调用函数 | ✅ 完成       | 添加 deleteAccount 函数 |
| 2024-11-30 | 步骤 2: 删除账户组件 | ✅ 完成       | 含二次确认对话框        |
| 2024-11-30 | 步骤 3: 页面集成     | ✅ 完成       | 添加「删除账户」Tab     |
| -          | 步骤 4: 测试验证     | ⏳ 待手动测试 | 需在运行环境中验证      |

## 相关文件

```
web/src/
├── api/auth/user.ts              # API 函数
├── pages/user/security/
│   ├── index.vue                 # 安全设置页面
│   └── components/
│       └── DeleteAccountSettings.vue  # 新组件
```

## 注意事项

1. **安全性**: 必须验证用户密码才能删除
2. **用户体验**: 提供清晰的警告信息，说明删除后果
3. **数据清理**: 删除成功后清除本地 Token 和状态
4. **跳转处理**: 删除成功后跳转到登录页

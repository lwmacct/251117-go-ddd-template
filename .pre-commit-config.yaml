# Pre-commit hooks configuration
# See https://pre-commit.com for more information

# 全局配置
default_stages: [pre-commit]
fail_fast: true # 发现第一个错误即停止

repos:
  # 本地自定义检查
  - repo: local
    hooks:
      - id: dto-naming
        name: Check DTO naming convention
        entry: scripts/check-dto-naming.sh
        language: script
        files: dto\.go$
        stages: [pre-commit]

      - id: application-naming
        name: Check Application layer naming convention
        entry: scripts/check-application-naming.sh
        language: script
        files: ^internal/application/.*\.go$
        stages: [pre-commit]

      - id: route-swagger-consistency
        name: Check route-swagger consistency
        entry: scripts/check-route-swagger-consistency.sh
        language: script
        pass_filenames: false
        stages: [pre-commit]
        files: ^internal/adapters/http/(router\.go|handler/.*\.go)$

      - id: swagger-generate
        name: Generate Swagger/OpenAPI docs
        entry: bash -c 'swag init -g internal/command/api/command.go -o internal/adapters/http/docs --parseDependency --parseInternal && pnpm run api:generate'
        language: system
        pass_filenames: false
        stages: [pre-commit]
        files: ^internal/(adapters/http/handler|command/api)/.*\.go$

      - id: frontend-typecheck
        name: Check frontend TypeScript types
        entry: pnpm run type-check
        language: system
        pass_filenames: false
        stages: [pre-commit]
        files: ^src/.*\.(ts|vue)$

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: check-yaml
      - id: check-merge-conflict
      - id: check-added-large-files
        args: ["--maxkb=512"]

  - repo: https://github.com/lwmacct/251211-pre-commit
    rev: v1.0.0
    hooks:
      - id: prettier
      - id: mc-mdtoc
      - id: build-docs
      - id: golangci-lint
      - id: config-sync
